#!/bin/bash
while [ 1 -gt 0 ]
do

txHash=$(./getLastHash)
if [ -z $txHash ]
  then
    sudo ./switchLock 1
    exit
fi

echo "Getting payload from last tx"
command=$(ioctl action hash $txHash -o json | jq -r '.message.proto.action.core.Action.Transfer.payload' | base64 -d -i)
if [ $command == "c" ]
  then
    echo "Received close"
    sudo ./switchLock 1
  else if [ $command == "o" ]
    then
      echo "Received open"
      sudo ./switchLock 0
    else
      echo "Unrecognised command: "$command
   fi
fi

sleep 0.1

done
